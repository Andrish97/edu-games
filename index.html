<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Neon Arcade</title>
  <style>
    body {
      background: radial-gradient(circle at top, #1f2933, #020617);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 32px 0;
    }

    .shell {
      width: 100%;
      max-width: 1100px;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .card {
      width: 100%;
      background: rgba(15,23,42,0.95);
      border-radius: 16px;
      padding: 20px 22px 22px;
      box-shadow:
        0 18px 45px rgba(0,0,0,0.8),
        0 0 0 1px rgba(148,163,184,0.12);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: .14em;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 13px;
      color: #9ca3af;
    }

    /* Pasek kategorii */
    .categories-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .cat-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        transform 0.06s ease,
        box-shadow 0.06s ease;
    }

    .cat-btn span.icon {
      font-size: 14px;
    }

    .cat-btn:hover {
      background: rgba(15,23,42,1);
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15,23,42,0.7);
    }

    .cat-btn.active {
      background: linear-gradient(135deg,#22c55e,#16a34a);
      border-color: #22c55e;
      color: #052e16;
      box-shadow: 0 8px 22px rgba(22,163,74,0.6);
    }

    /* Siatka gier w aktualnej kategorii */
    #games {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .game-card {
      border-radius: 14px;
      background: radial-gradient(circle at top, #020617, #020617);
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow:
        0 10px 25px rgba(0,0,0,0.7),
        0 0 0 1px rgba(15,23,42,0.8);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }

    .game-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 32px rgba(0,0,0,0.85);
      border-color: rgba(34,197,94,0.8);
    }

    .thumb-wrap {
      border-radius: 10px;
      overflow: hidden;
      background: #020617;
      border: 1px solid rgba(15,23,42,0.9);
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .thumb-wrap img {
      max-width: 100%;
      max-height: 100%;
      display: block;
      object-fit: cover;
    }

    .thumb-placeholder {
      font-size: 32px;
      opacity: 0.7;
    }

    .game-headline {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 600;
    }

    .game-icon {
      font-size: 18px;
    }

    .game-name {
      letter-spacing: .04em;
      text-transform: uppercase;
    }

    .game-desc {
      font-size: 12px;
      color: #9ca3af;
      min-height: 32px;
    }

    .game-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #6b7280;
    }

    .pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.35);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .1em;
    }

    .play-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #052e16;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(22,163,74,0.55);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .play-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 9px 20px rgba(22,163,74,0.7);
      filter: brightness(1.05);
    }

    .play-btn:active {
      transform: translateY(0) scale(0.97);
      box-shadow: 0 5px 14px rgba(22,163,74,0.6);
      filter: brightness(0.97);
    }

    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-top: -4px;
    }
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script>
	  const SUPABASE_URL = "https://zbcpqwugthvizqzkvurw.supabase.co";
	  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpiY3Bxd3VndGh2aXpxemt2dXJ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MTk1NDYsImV4cCI6MjA4MDQ5NTU0Nn0.fTZiJjToYxnvhthiSIpAcmJ2wo7gQ2bAko841_dh740";

	  // globalny klient Supabase (cdn daje obiekt supabase) :contentReference[oaicite:1]{index=1}
	  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

	  async function getCurrentUser() {
		const { data } = await sb.auth.getUser();
		return data.user || null;
	  }

	  // ZAPIS progresu: je≈õli user zalogowany ‚Üí Supabase, je≈õli nie ‚Üí localStorage
	  async function saveProgress(gameId, progressData) {
		const user = await getCurrentUser();
		if (!user) {
		  localStorage.setItem("progress_local_" + gameId, JSON.stringify(progressData));
		  return;
		}

		const { error } = await sb
		  .from("user_progress")
		  .upsert({
			user_id: user.id,
			game_id: gameId,
			data: progressData,
			updated_at: new Date().toISOString()
		  });

		if (error) {
		  console.error("B≈ÇƒÖd zapisu progresu:", error);
		}
	  }

	  // ODCZYT progresu: najpierw Supabase, jak brak lub nie zalogowany ‚Üí localStorage
	  async function loadProgress(gameId) {
		const user = await getCurrentUser();
		if (!user) {
		  const raw = localStorage.getItem("progress_local_" + gameId);
		  return raw ? JSON.parse(raw) : null;
		}

		const { data, error } = await sb
		  .from("user_progress")
		  .select("data")
		  .eq("user_id", user.id)
		  .eq("game_id", gameId)
		  .maybeSingle();

		if (error) {
		  console.error("B≈ÇƒÖd odczytu progresu:", error);
		  return null;
		}
		return data ? data.data : null;
	  }

	  // udostƒôpniamy globalnie dla gier
	  window.ArcadeBackend = {
		sb,
		getCurrentUser,
		saveProgress,
		loadProgress
	  };
	</script>

</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="header">
	  <div id="auth-bar" style="
		  display:flex;
		  flex-wrap:wrap;
		  gap:8px;
		  align-items:center;
		  font-size:12px;
		  margin-top:4px;
	  ">
		  <span id="auth-status" style="color:#9ca3af;">Sprawdzam logowanie...</span>
		  <input id="auth-email" type="email" placeholder="email"
			style="padding:4px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.5);background:#020617;color:#e5e7eb;font-size:12px;min-width:160px;">
		  <input id="auth-pass" type="password" placeholder="has≈Ço"
			style="padding:4px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.5);background:#020617;color:#e5e7eb;font-size:12px;min-width:120px;">
		  <button id="btn-login" class="play-btn" style="font-size:11px;padding:4px 10px;">Zaloguj</button>
		  <button id="btn-register" class="play-btn" style="font-size:11px;padding:4px 10px;background:linear-gradient(135deg,#38bdf8,#0ea5e9);box-shadow:0 6px 18px rgba(56,189,248,0.55);">Rejestracja</button>
		  <button id="btn-logout" class="play-btn" style="font-size:11px;padding:4px 10px;display:none;background:linear-gradient(135deg,#f97316,#ea580c);box-shadow:0 6px 18px rgba(249,115,22,0.55);">Wyloguj</button>
		  <button id="btn-guest" class="play-btn" style="
			  font-size:11px;
			  padding:4px 10px;
			  background:linear-gradient(135deg,#6b7280,#4b5563);
			  box-shadow:0 6px 18px rgba(107,114,128,0.55);
			">Graj jako go≈õƒá</button>

	   </div>

        <div>
          <div class="title">Neon Arcade</div>
          <div class="subtitle">
            Wybierz kategoriƒô, a potem grƒô. Ka≈ºda uruchamia siƒô na ca≈Çe okno, wr√≥cisz przyciskiem ‚ÄûPowr√≥t do Arcade‚Äù.
          </div>
        </div>
      </div>

      <!-- Pasek kategorii -->
      <div class="categories-row" id="categories"></div>

      <!-- Gry z aktualnie wybranej kategorii -->
      <div id="games"></div>

      <div class="hint">
        Gry sƒÖ generowane automatycznie z list w JavaScript. ≈ªeby dodaƒá nowƒÖ:
        dodaj plik <code>.html</code> i dopisz pozycjƒô do odpowiedniej tablicy
        (<code>CLASSIC_GAMES</code> lub <code>LANGUAGE_GAMES</code>).
      </div>
    </div>
  </div>

<script>
  // üëá Gry klasyczne ‚Äì w folderze classic
  const CLASSIC_GAMES = [
    {
      id: "snake",
      file: "classic/snake.html",
      name: "Snake",
      icon: "üêç",
      thumb: "img/snake.png",
      description: "Klasyczny wƒÖ≈º w neonowym wydaniu: przechodzi przez ≈õciany i przy≈õpiesza po zjedzeniu jab≈Çka."
    },
    {
      id: "tetris",
      file: "classic/tetris.html",
      name: "Tetris",
      icon: "üß±",
      thumb: "img/tetris.png",
      description: "Neonowe klocki, ghost piece, poziomy i przyspieszanie. Klasyk w pikselowym garniturze."
    },
    {
      id: "saper",
      file: "classic/saper.html",
      name: "Saper",
      icon: "üí£",
      thumb: "img/saper.png",
      description: "Minesweeper: r√≥≈ºne rozmiary planszy, proporcjonalna liczba min, pierwsze klikniƒôcie zawsze bezpieczne."
    },
    {
      id: "wordl",
      file: "classic/wordl.html",
      name: "Wordl PL",
      icon: "üî§",
      thumb: "img/wordl.png",
      description: "Polski Wordle: zgadnij s≈Çowo 4‚Äì7 liter, s≈Çownik z internetu, kolorowe podpowiedzi jak w oryginale."
    },
    {
      id: "2048",
      file: "classic/2048.html",
      name: "2048",
      icon: "üî¢",
      thumb: "img/2048.png",
      description: "P≈Çynne, animowane 2048 z neonowymi kafelkami i lokalnym rekordem."
    },
    {
      id: "pong",
      file: "classic/pong.html",
      name: "Pong",
      icon: "üèì",
      thumb: "img/pong.png",
      description: "Neonowy Pong z p≈ÇynnƒÖ pi≈ÇkƒÖ, prostym AI i sterowaniem W/S lub strza≈Çkami."
    }
  ];

  // üëá Gry jƒôzykowe ‚Äì w folderze language
  const LANGUAGE_GAMES = [
    {
      id: "znajdz_slowo",
      file: "language/znajdz_slowo.html",
      name: "Znajd≈∫ s≈Çowo",
      icon: "üìñ",
      thumb: null, // np. "img/znajdz_slowo.png", je≈õli dorobisz miniaturkƒô
      description: "Szukaj s≈Ç√≥w pasujƒÖcych do obrazk√≥w. ≈öwiaty tematyczne, levele i punkty za serie poprawnych odpowiedzi."
    }
  ];

  // Kategorie ‚Äì meta
  const CATEGORIES = [
    {
      id: "classic",
      name: "Gry klasyczne",
      icon: "üéÆ",
      games: CLASSIC_GAMES
    },
    {
      id: "language",
      name: "Gry jƒôzykowe",
      icon: "üó£Ô∏è",
      games: LANGUAGE_GAMES
    }
  ];

  function launchGame(file) {
    window.location.href = file + "?fullscreen=1";
  }

  function createGameCard(game) {
    const card = document.createElement("div");
    card.className = "game-card";

    card.onclick = (e) => {
      if (e.target.closest("button")) return;
      launchGame(game.file);
    };

    const thumbWrap = document.createElement("div");
    thumbWrap.className = "thumb-wrap";

    if (game.thumb) {
      const img = document.createElement("img");
      img.src = game.thumb;
      img.alt = game.name;
      img.onerror = () => {
        thumbWrap.innerHTML = `<div class="thumb-placeholder">${game.icon || "üéÆ"}</div>`;
      };
      thumbWrap.appendChild(img);
    } else {
      thumbWrap.innerHTML = `<div class="thumb-placeholder">${game.icon || "üéÆ"}</div>`;
    }

    const headline = document.createElement("div");
    headline.className = "game-headline";
    headline.innerHTML = `
      <span class="game-icon">${game.icon || "üéÆ"}</span>
      <span class="game-name">${game.name}</span>
    `;

    const desc = document.createElement("div");
    desc.className = "game-desc";
    desc.textContent = game.description || "";

    const footer = document.createElement("div");
    footer.className = "game-footer";
    footer.innerHTML = `<span class="pill">HTML / Canvas</span>`;

    const play = document.createElement("button");
    play.className = "play-btn";
    play.textContent = "Graj";
    play.onclick = (e) => {
      e.stopPropagation();
      launchGame(game.file);
    };
    footer.appendChild(play);

    card.appendChild(thumbWrap);
    card.appendChild(headline);
    card.appendChild(desc);
    card.appendChild(footer);

    return card;
  }

  function renderGamesForCategory(catId) {
    const category = CATEGORIES.find(c => c.id === catId);
    if (!category) return;

    const gamesContainer = document.getElementById("games");
    gamesContainer.innerHTML = "";

    const sorted = [...category.games].sort((a, b) =>
      a.name.localeCompare(b.name, "pl")
    );

    sorted.forEach(game => {
      gamesContainer.appendChild(createGameCard(game));
    });
  }

  function renderCategories() {
    const catContainer = document.getElementById("categories");
    catContainer.innerHTML = "";

    CATEGORIES.forEach(cat => {
      const btn = document.createElement("button");
      btn.className = "cat-btn";
      btn.dataset.catId = cat.id;
      btn.innerHTML = `
        <span class="icon">${cat.icon}</span>
        <span>${cat.name}</span>
      `;
      btn.onclick = () => {
        // aktywny styl
        document.querySelectorAll(".cat-btn").forEach(b => {
          b.classList.toggle("active", b === btn);
        });
        renderGamesForCategory(cat.id);
      };
      catContainer.appendChild(btn);
    });

    // domy≈õlnie aktywna pierwsza kategoria
    const first = catContainer.querySelector(".cat-btn");
    if (first) {
      first.classList.add("active");
      renderGamesForCategory(first.dataset.catId);
    }
  }

  renderCategories();
</script>

<script>
  async function refreshAuthBar() {
    const statusEl = document.getElementById("auth-status");
    const emailInput = document.getElementById("auth-email");
    const passInput = document.getElementById("auth-pass");
    const btnLogin = document.getElementById("btn-login");
    const btnRegister = document.getElementById("btn-register");
    const btnLogout = document.getElementById("btn-logout");

    const user = await ArcadeBackend.getCurrentUser();

    if (user) {
      statusEl.textContent = "Zalogowany jako: " + (user.email || user.id);
      emailInput.style.display = "none";
      passInput.style.display = "none";
      btnLogin.style.display = "none";
      btnRegister.style.display = "none";
      btnLogout.style.display = "inline-block";
    } else {
      statusEl.textContent = "Nie zalogowany ‚Äì progres zapisze siƒô lokalnie.";
      emailInput.style.display = "inline-block";
      passInput.style.display = "inline-block";
      btnLogin.style.display = "inline-block";
      btnRegister.style.display = "inline-block";
      btnLogout.style.display = "none";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    refreshAuthBar();

    document.getElementById("btn-login").onclick = async () => {
      const email = document.getElementById("auth-email").value;
      const pass = document.getElementById("auth-pass").value;
      const { error } = await ArcadeBackend.sb.auth.signInWithPassword({ email, password: pass });
      if (error) alert("B≈ÇƒÖd logowania: " + error.message);
      await refreshAuthBar();
    };

    document.getElementById("btn-register").onclick = async () => {
      const email = document.getElementById("auth-email").value;
      const pass = document.getElementById("auth-pass").value;
      const { error } = await ArcadeBackend.sb.auth.signUp({ email, password: pass });
      if (error) alert("B≈ÇƒÖd rejestracji: " + error.message);
      else alert("Sprawd≈∫ maila, ≈ºeby potwierdziƒá konto.");
      await refreshAuthBar();
    };

    document.getElementById("btn-logout").onclick = async () => {
      await ArcadeBackend.sb.auth.signOut();
      await refreshAuthBar();
    };
  });
</script>

<script>
  let guestMode = false;

  function enableGuestMode() {
    guestMode = true;
    document.getElementById("auth-status").textContent =
      "Tryb go≈õcia: zapis lokalny (brak logowania)";

    document.getElementById("auth-email").style.display = "none";
    document.getElementById("auth-pass").style.display = "none";
    document.getElementById("btn-login").style.display = "none";
    document.getElementById("btn-register").style.display = "none";
    document.getElementById("btn-logout").style.display = "none";
  }

  document.addEventListener("DOMContentLoaded", () => {
    // przycisk "Graj jako go≈õƒá"
    document.getElementById("btn-guest").onclick = () => {
      enableGuestMode();
    };

    refreshAuthBar();
  });

  // nadpisujemy save/load gdy tryb go≈õcia aktywny
  const originalSave = ArcadeBackend.saveProgress;
  const originalLoad = ArcadeBackend.loadProgress;

  ArcadeBackend.saveProgress = async (gameId, data) => {
    if (guestMode) {
      localStorage.setItem("progress_guest_" + gameId, JSON.stringify(data));
      return;
    }
    return originalSave(gameId, data);
  };

  ArcadeBackend.loadProgress = async (gameId) => {
    if (guestMode) {
      const raw = localStorage.getItem("progress_guest_" + gameId);
      return raw ? JSON.parse(raw) : null;
    }
    return originalLoad(gameId);
  };
</script>

</body>
</html>
