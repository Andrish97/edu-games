<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Neon Arcade – start</title>

  <link rel="stylesheet" href="css/arcade-theme.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/arcade-core.js"></script>
</head>
<body class="arcade-body">
  <div class="shell arcade-login-shell">
    <div class="card arcade-login-card">
      <div class="arcade-login-title">Neon Arcade</div>
      <div class="arcade-login-subtitle">
        Zaloguj się albo wejdź jako gość.
      </div>

      <div class="arcade-login-label">Email</div>
      <input id="email" type="email" class="arcade-login-input" placeholder="twoj@mail.com">

      <div class="arcade-login-label">Hasło</div>
      <input id="pass" type="password" class="arcade-login-input" placeholder="••••••••">

      <div class="arcade-login-label">Powtórz hasło (tylko przy rejestracji)</div>
      <input id="pass2" type="password" class="arcade-login-input" placeholder="••••••••">

      <div class="arcade-login-row">
        <button id="btn-login" class="arcade-btn-main">Zaloguj</button>
        <button id="btn-register" class="arcade-btn-secondary">Załóż konto</button>
      </div>

      <button id="btn-forgot" class="arcade-btn-link">Przypomnij hasło</button>

      <button id="btn-guest" class="arcade-btn-ghost">Graj jako gość</button>

      <div id="error" class="arcade-login-error"></div>

      <div class="arcade-login-hint">
        Gość zapisuje wyniki tylko na tym urządzeniu. <br>
        Konto pozwala przechowywać progres w chmurze.
      </div>
    </div>
  </div>

  <script>
    const emailInput = document.getElementById("email");
    const passInput = document.getElementById("pass");
    const pass2Input = document.getElementById("pass2");
    const btnLogin = document.getElementById("btn-login");
    const btnRegister = document.getElementById("btn-register");
    const btnGuest = document.getElementById("btn-guest");
    const btnForgot = document.getElementById("btn-forgot");
    const errorBox = document.getElementById("error");

    function showError(msg) {
      errorBox.textContent = msg || "";
    }

    function goToArcade() {
      window.location.href = "arcade.html";
    }

    btnGuest.onclick = () => {
      ArcadeCore.setGuest();
      showError("");
      goToArcade();
    };

    btnLogin.onclick = async () => {
      showError("");
      const email = emailInput.value.trim();
      const pass = passInput.value;
      if (!email || !pass) {
        showError("Podaj email i hasło.");
        return;
      }
      const { error } = await ArcadeCore.login(email, pass);
      if (error) {
        showError("Nieprawidłowy email lub hasło.");
        return;
      }
      goToArcade();
    };

    btnRegister.onclick = async () => {
      showError("");
      const email = emailInput.value.trim();
      const pass = passInput.value;
      const pass2 = pass2Input.value;

      if (!email || !pass || !pass2) {
        showError("Uzupełnij wszystkie pola.");
        return;
      }
      if (pass !== pass2) {
        showError("Hasła muszą być takie same.");
        return;
      }
      if (pass.length < 6) {
        showError("Hasło powinno mieć co najmniej 6 znaków.");
        return;
      }

      const { error } = await ArcadeCore.register(email, pass);
      if (error) {
        const msg = (error.message || "").toLowerCase();
        if (msg.includes("already") || msg.includes("registered")) {
          showError("Taki użytkownik już istnieje. Spróbuj się zalogować.");
        } else {
          showError("Błąd rejestracji: " + error.message);
        }
        return;
      }
      alert("Konto utworzone. Sprawdź maila w sprawie aktywacji.");
      goToArcade();
    };

    btnForgot.onclick = async () => {
      showError("");
      const email = emailInput.value.trim();
      if (!email) {
        showError("Podaj email, na który wysłać link.");
        return;
      }
      const { error } = await ArcadeCore.resetPassword(
        email,
        window.location.origin + "/arcade.html"
      );
      if (error) {
        showError("Nie udało się wysłać maila: " + error.message);
        return;
      }
      alert("Jeśli konto istnieje, wyślemy mail z linkiem do ustawienia nowego hasła.");
    };
  </script>
</body>
</html>
