<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Neon Arcade</title>

  <link rel="stylesheet" href="css/arcade-theme.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/arcade-core.js"></script>
</head>
<body class="arcade-body">
  <div class="shell" id="arcade-main">
    <div class="card">
      <div class="header">
        <div>
          <div class="title">Neon Arcade</div>
          <div class="subtitle">
            Wybierz grÄ™ i zanurz siÄ™ w neonie.
          </div>
        </div>
      </div>

      <div class="categories-row" id="categories"></div>
      <div id="games"></div>
    </div>
  </div>

  <script>
    const CLASSIC_GAMES = [
      {
        id: "snake",
        file: "classic/snake.html",
        name: "Snake",
        icon: "ðŸ",
        thumb: "img/snake.png",
        description: "Klasyczny wÄ…Å¼ w neonowym wydaniu."
      },
      {
        id: "tetris",
        file: "classic/tetris.html",
        name: "Tetris",
        icon: "ðŸ§±",
        thumb: "img/tetris.png",
        description: "UkÅ‚adaj klocki, Å¼eby nie siÄ™gnÄ™Å‚y sufitu."
      },
      {
        id: "saper",
        file: "classic/saper.html",
        name: "Saper",
        icon: "ðŸ’£",
        thumb: "img/saper.png",
        description: "Odkrywaj pola, unikaj min."
      },
      {
        id: "wordl",
        file: "classic/wordl.html",
        name: "Wordl PL",
        icon: "ðŸ”¤",
        thumb: "img/wordl.png",
        description: "Zgadnij sÅ‚owo na litery."
      },
      {
        id: "2048",
        file: "classic/2048.html",
        name: "2048",
        icon: "ðŸ”¢",
        thumb: "img/2048.png",
        description: "ÅÄ…cz liczby, aÅ¼ dojdziesz do 2048."
      },
      {
        id: "pong",
        file: "classic/pong.html",
        name: "Pong",
        icon: "ðŸ“",
        thumb: "img/pong.png",
        description: "Odbijaj piÅ‚kÄ™ szybciej niÅ¼ przeciwnik."
      }
    ];

    const LANGUAGE_GAMES = [
      {
        id: "znajdz_slowo",
        file: "language/znajdz_slowo.html",
        name: "ZnajdÅº sÅ‚owo",
        icon: "ðŸ“–",
        thumb: null,
        description: "Dobieraj sÅ‚owa do obrazkÃ³w."
      }
    ];

    const CATEGORIES = [
      {
        id: "classic",
        name: "Klasyki",
        icon: "ðŸŽ®",
        games: CLASSIC_GAMES
      },
      {
        id: "language",
        name: "JÄ™zykowe",
        icon: "ðŸ—£ï¸",
        games: LANGUAGE_GAMES
      }
    ];

    function launchGame(file) {
      window.location.href = file + "?fullscreen=1";
    }

    function createGameCard(game) {
      const card = document.createElement("div");
      card.className = "game-card";

      card.onclick = (e) => {
        if (e.target.closest("button")) return;
        launchGame(game.file);
      };

      const thumbWrap = document.createElement("div");
      thumbWrap.className = "thumb-wrap";

      if (game.thumb) {
        const img = document.createElement("img");
        img.src = game.thumb;
        img.alt = game.name;
        img.onerror = () => {
          thumbWrap.innerHTML = `<div class="thumb-placeholder">${game.icon || "ðŸŽ®"}</div>`;
        };
        thumbWrap.appendChild(img);
      } else {
        thumbWrap.innerHTML = `<div class="thumb-placeholder">${game.icon || "ðŸŽ®"}</div>`;
      }

      const headline = document.createElement("div");
      headline.className = "game-headline";
      headline.innerHTML = `
        <span class="game-icon">${game.icon || "ðŸŽ®"}</span>
        <span class="game-name">${game.name}</span>
      `;

      const desc = document.createElement("div");
      desc.className = "game-desc";
      desc.textContent = game.description || "";

      const footer = document.createElement("div");
      footer.className = "game-footer";
      footer.innerHTML = `<span class="pill">Gra</span>`;

      const play = document.createElement("button");
      play.className = "play-btn";
      play.textContent = "Graj";
      play.onclick = (e) => {
        e.stopPropagation();
        launchGame(game.file);
      };
      footer.appendChild(play);

      card.appendChild(thumbWrap);
      card.appendChild(headline);
      card.appendChild(desc);
      card.appendChild(footer);

      return card;
    }

    function renderGamesForCategory(catId) {
      const category = CATEGORIES.find(c => c.id === catId);
      if (!category) return;

      const gamesContainer = document.getElementById("games");
      gamesContainer.innerHTML = "";

      const sorted = [...category.games].sort((a, b) =>
        a.name.localeCompare(b.name, "pl")
      );

      sorted.forEach(game => {
        gamesContainer.appendChild(createGameCard(game));
      });
    }

    function renderCategories() {
      const catContainer = document.getElementById("categories");
      catContainer.innerHTML = "";

      CATEGORIES.forEach(cat => {
        const btn = document.createElement("button");
        btn.className = "cat-btn";
        btn.dataset.catId = cat.id;
        btn.innerHTML = `
          <span class="icon">${cat.icon}</span>
          <span>${cat.name}</span>
        `;
        btn.onclick = () => {
          document.querySelectorAll(".cat-btn").forEach(b => {
            b.classList.toggle("active", b === btn);
          });
          renderGamesForCategory(cat.id);
        };
        catContainer.appendChild(btn);
      });

      const first = catContainer.querySelector(".cat-btn");
      if (first) {
        first.classList.add("active");
        renderGamesForCategory(first.dataset.catId);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      ArcadeCore.initIndex();   // pasek u gÃ³ry
      renderCategories();       // lista gier
    });
  </script>
</body>
</html>
